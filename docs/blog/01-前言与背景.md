# 01 - 前言与背景

这一篇先不讲代码，只讲「这个项目为什么要做、能做什么、大致用什么技术」，方便后面每一篇「实现」有背景可依。

---

## 一、要解决什么问题

做股票（或基金）分析时，通常会遇到几件事：

1. **数据散**：行情、新闻、财报、期权分散在不同地方，要自己拼起来才好看。  
2. **结论难统一**：技术派看均线/MACD，基本面派看财报/估值，消息派看新闻，很难在一页里给出「综合结论」。  
3. **重复劳动**：每次分析都要重新拉数据、重新看一遍，历史结论不易复用和对比。  
4. **希望有「一句话结论」**：例如「这只股票当前值不值得关注、评分多少、建议买入/观察/离场」，而不是只有一堆数字。

**Stock Agent 的目标**就是：  
把「技术面 + 消息面 + 财报 + 期权」等数据自动拉齐，用 **大模型（LLM）** 做一次综合研判，输出 **评分、交易动作、核心结论、评分理由** 等，并生成一份可筛选、可排序的 **HTML 报告**，还能选做「深度分析」和「与上次对比」，减少重复劳动、提升可解释性。

---

## 二、能做什么（功能概览）

- **多市场**：支持美股、A 股、港股；A 股 6 位代码可自动补 `.SS`/`.SZ`，港股 4 位可补 `.HK`。  
- **选股方式**：可以指定若干只股票（`tickers=AAPL,MSFT`），也可以按「市场 + 选股池」自动取一批（如美股大盘、美股小盘、A 股小盘等）。  
- **K 线维度**：支持日 K（波段）和分 K（1/5/15 分钟等），可选含盘前盘后；日 K 且勾选盘前盘后时，涨跌幅用盘前/盘后价。  
- **单只分析**：  
  - 技术面（均线、MACD、KDJ、入场/离场参考）  
  - 消息面（近期新闻 + 可选 LLM 新闻摘要）  
  - 财报与估值（财报摘要 + 可选 LLM 财报解读、PE、市值、涨跌幅等）  
  - 期权多空（Put/Call 成交量比，偏多/偏空/中性）  
- **综合评分**：把上面几块拼成一段 Prompt，让 LLM 输出「核心结论、趋势结构、MACD/KDJ 状态、分析原因、评分（1～10）、评分理由、交易动作（买入/观察/离场）、加仓/减仓价」等 **10 项**，解析后写入报告卡片。  
- **报告**：多只股票跑完后生成一份 HTML 报告，带「报告总览」、评分理由、筛选（评分/交易动作/市场）、排序，并自动保存到 `report/output/report-MMDD-HHMM.html`。  
- **深度模式**（可选）：在综合评分之外，再跑「基本面深度、护城河、同行对比、空头视角、叙事变化」五类分析，并对评分做一次 LLM 微调；支持「与上次对比」和持久化记忆（`memory_store`）。

也就是说：**从「选股 → 拉数据 → 综合研判 → 出报告」是一条龙自动化的，你主要关心「选哪批股票、要不要深度、看报告结果」即可。**

---

## 三、技术选型思路（通俗版）

- **数据从哪来**：用 **yfinance** 拉行情、新闻、财报、期权等，免费、接口简单，覆盖美股/A股/港股。  
- **谁来做「综合结论」**：用 **大模型（LLM）** 把「技术 + 消息 + 财报 + 期权」当一段文字读，按固定格式输出 10 项，既保证可解析，又保留自然语言的可解释性（如评分理由）。  
- **LLM 用谁**：默认用本地 **Ollama**（如 qwen2.5:3b），免 API Key、免费用；也可换成 DeepSeek/OpenAI 等云端 API（通过环境变量配置）。  
- **报告怎么出**：用 **FastAPI** 提供 HTTP 接口，报告用 **HTML + 内联 CSS/JS** 生成，筛选和排序在前端用 JS 完成，不依赖复杂前端框架。  
- **深度分析与记忆**：可选 **LangChain** 做多步链（基本面深度、护城河、同行对比等），历史分析结果存 **JSONL**（`memory_store`），按「标的 + 分析类型」检索，用于「与上次对比」。

这样选型的目的是：**在尽量少依赖、少付费的前提下，把「多维度数据 + 一句结论」打通，并留出扩展口（换模型、加 RAG、接 IM 等）。**

---

## 四、和「量化/投顾」的区别

- **不做自动交易**：没有下单、没有实盘接口，只做「拉数据 + 分析 + 出报告」。  
- **评分是 LLM 综合出来的**：不是纯公式打分，而是模型根据 Prompt 里的技术/消息/财报/期权描述「自己给分」，所以会受模型和 Prompt 影响；我们通过「评分理由」和「报告总览」提升可解释性。  
- **报告仅供参考**：代码里带免责声明，不构成投资建议；数据来源公开、可能存在延迟或误差。

---

## 五、下一篇预告

下一篇会讲 **项目整体架构**：目录结构、数据流、以及「从点开 Report 到看到 HTML 报告」中间每一步大致经过哪些模块，方便后面按「步骤」逐篇对照实现。
