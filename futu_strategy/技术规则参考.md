# 富途策略技术规则参考（与主项目技术指标一致）

本目录策略为**独立脚本**，不依赖主项目；以下规则从主项目技术文档提炼，用于在富途里自实现买卖条件时对照。

---

## 一、指标计算（若平台提供 K 线，可用 Python 自编指标实现）

**富途内置 API 可直接使用（策略中已用）：**

- **ma(symbol, period, bar_type, data_type, select, session_type)** → float  
- **atr(symbol, period, bar_type, select, session_type)** → float（若有）  
- **is_ma_bullish_alignment / is_ma_bearish_alignment** → bool  
- **is_kdj_golden_cross / is_kdj_death_cross**（低位金叉 / 高位死叉）→ bool  
- **is_kdj_top_divergence / is_kdj_bottom_divergence**（顶背离 / 底背离）→ bool  
- **kdj_k / kdj_d / kdj_j(symbol, k_period=9, d_period=3, slowing=3, bar_type, select, session_type)** → float  
- **macd_dif / macd_dea / macd_macd(symbol, fast_period=12, slow_period=26, signal_period=9, bar_type, select, session_type)** → float；**is_macd_golden_cross / is_macd_death_cross / is_macd_top_divergence / is_macd_bottom_divergence** → bool  
- **rsi(symbol, period=12, bar_type, select, session_type)** → float；**is_rsi_golden_cross / is_rsi_death_cross**(fast_period=6, slow_period=12)、**is_rsi_top_divergence / is_rsi_bottom_divergence**(period=12) → bool  
- **bar_chg_rate(symbol, bar_type, select, session_type)** → float（单根 K 线前复权涨跌幅，如 0.05=5%）  
- **bar_custom(symbol, data_type=BarDataType.CHG_RATE, custom_num, custom_type, select, session_type)** → float（多根 K 线聚合涨跌幅，如近 8 日涨跌幅，custom_type=CustomType.D1）
- **bar_turnover(symbol, bar_type, select, session_type)** → float（单根 K 线前复权成交额）
- **bar_custom(..., data_type=BarDataType.TURNOVER, custom_num, custom_type, ...)** → float（多根 K 线聚合成交额，如近 20 日总成交额；量比 = 单根成交额 / (近20日总成交额/20)）  

以下为自编指标时的公式对照（与主项目一致）：

| 指标 | 公式 / 参数 |
|------|-------------|
| **MA** | 收盘价 Close 的简单移动平均：MA5(5 根)、MA10、MA20、MA60 |
| **MACD** | 快线 EMA(Close,12)，慢线 EMA(Close,26)，MACD线=快-慢，信号线=MACD 的 9 日 EMA，柱=MACD-信号线 |
| **KDJ** | RSV=(Close-9日最低)/(9日最高-9日最低)×100；K=RSV 的 3 日 EMA，D=K 的 3 日 EMA，J=3K-2D |
| **RSI(14)** | delta=Close-前收；涨均=EMA(涨,α=1/14)，跌均=EMA(跌)；RS=涨均/跌均，RSI=100-100/(1+RS) |
| **ATR(14)** | TR=max(High-Low, \|High-前收\|, \|Low-前收\|)；ATR=TR 的 14 日 SMA |

---

## 二、卖出 / 离场条件（满足其一即可提醒）

1. **固定减仓价**：当前价 ≤ 减仓价 → 建议卖出  
2. **跌破 MA20**：当前价 ≤ MA20 → 减仓  
3. **跌破 MA60**：当前价 ≤ MA60 → 离场  
4. **ATR 止损**：当前价 ≤ (参考价 - N×ATR)，N 常用 1.5 → 离场  
5. **MA 空头排列**：is_ma_bearish_alignment → 偏空  
6. **KDJ 高位死叉**：is_kdj_death_cross → 偏空  
7. **KDJ 顶背离**：is_kdj_top_divergence → 偏空  
8. **KDJ 超买**：K > 80 → 注意回调  
9. **单根 K 线大涨**：bar_chg_rate >= 阈值(如 5%) → 注意追高  
10. **近 N 日涨幅过大**：bar_custom(CHG_RATE, N 日) >= 阈值(如 15%) → 考虑止盈  
11. **放量下跌**：量比(成交额) >= 1.5 且 单根 K 线跌 → 需警惕  
12. **MACD 死叉**：is_macd_death_cross → 偏空  
13. **MACD 顶背离**：is_macd_top_divergence → 偏空  
14. **RSI 高位死叉**：is_rsi_death_cross → 偏空  
15. **RSI 顶背离**：is_rsi_top_divergence → 偏空  
16. **RSI 超买**：RSI > 70 → 注意回调  

---

## 三、买入 / 入场条件（可作提醒）

1. **站上 MA20**：当前价 ≥ MA20 → 可考虑入场  
2. **MA 多头排列**：is_ma_bullish_alignment → 偏多  
3. **突破近期高点**：当前价突破过去约 20 根 K 线最高价 → 强势信号  
4. **放量突破**：量比 ≥ 1.5 且突破近期高点 → 更可信（需成交量）  
5. **KDJ 低位金叉**：is_kdj_golden_cross → 偏多  
6. **KDJ 底背离**：is_kdj_bottom_divergence → 偏多  
7. **KDJ 超卖**：K < 20 → 可关注低吸  
8. **RSI 超卖**：RSI < 30 → 可关注低吸  
9. **MACD 金叉**：MACD 线由下上穿信号线 → 偏多  
10. **单根 K 线大跌**：bar_chg_rate <= 负阈值(如 -5%) → 关注超跌  
11. **近 N 日跌幅过大**：bar_custom(CHG_RATE, N 日) <= 负阈值(如 -10%) → 关注超跌反弹  
12. **放量突破/放量上涨**：量比(单根成交额/近20日均额) >= 1.5 且 (站上 MA20 或 单根涨) → 可参考入场  
13. **MACD 金叉**：is_macd_golden_cross → 偏多  
14. **MACD 底背离**：is_macd_bottom_divergence → 偏多  
15. **RSI 低位金叉**：is_rsi_golden_cross → 偏多  
16. **RSI 底背离**：is_rsi_bottom_divergence → 偏多  
17. **RSI 超卖**：RSI < 30 → 可关注低吸  

---

## 四、与策略文件的对应关系

- **strategy_technical.py**：**所有信号由富途多类 API 计算**。  
  - **MA**：ma() 取 MA20/MA60，is_ma_bullish_alignment / is_ma_bearish_alignment；止损参考价 = MA20，止损价 = MA20 - 1.5×atr(14)。  
  - **KDJ**：is_kdj_golden_cross（低位金叉）、is_kdj_death_cross（高位死叉）、is_kdj_top_divergence（顶背离）、is_kdj_bottom_divergence（底背离）、kdj_k / kdj_d / kdj_j 取 K 值做超买(>80)/超卖(<20)。  
  - **MACD**：macd_dif, macd_dea, macd_macd，is_macd_golden_cross, is_macd_death_cross, is_macd_top_divergence, is_macd_bottom_divergence。  
  - **RSI**：rsi(period=12)，is_rsi_golden_cross, is_rsi_death_cross(fast=6, slow=12)，is_rsi_top_divergence, is_rsi_bottom_divergence(period=12)，RSI>70 超买/RSI<30 超卖。  
  - 买入：MA 多头或站上 MA20，或 KDJ 金叉/底背离/超卖，或 MACD 金叉/底背离，或 RSI 金叉/底背离/超卖，或超跌/放量突破；卖出：跌破 MA20/MA60、MA 空头、ATR 止损，或 KDJ/MACD/RSI 死叉/顶背离/超买，或追高/止盈/放量下跌。
